{
  "type": "OBJECT",
  "properties": {
    "total_marks": {
      "type": "NUMBER",
      "description": "The total marks awarded for the entire paper."
    },
    "total_available_marks": {
      "type": "NUMBER",
      "description": "The total possible marks available for the entire paper."
    },
    "paper_name": {
      "type": "STRING",
      "description": "The name of the exam paper."
    },
    "summary_comments": {
      "type": "STRING",
      "description": "Overall feedback on the paper."
    },
    "question_breakdown": {
      "type": "ARRAY",
      "items": {
        "type": "OBJECT",
        "properties": {
          "question_id": {
            "type": "STRING",
            "description": "The question number (e.g., '1', '2', '3(a)')."
          },
          "student_transcript": {
            "type": "STRING",
            "description": "Transcription of the student's handwritten answer."
          },
          "marks_awarded": {
            "type": "NUMBER",
            "description": "Marks given for this question."
          },
          "max_marks_available": {
            "type": "NUMBER",
            "description": "Maximum marks possible for this question."
          },
          "reasoning": {
            "type": "STRING",
            "description": "Detailed explanation for the mark awarded."
          },
          "missed_mark_reasoning": {
            "type": "STRING",
            "description": "Explanation of why full marks were NOT awarded. State 'None' if full marks given."
          },
          "required_for_improvement": {
            "type": "STRING",
            "description": "Actionable advice to achieve higher marks."
          },
          "citations": {
            "type": "ARRAY",
            "description": "REQUIRED: Must include at least one 'student_answer' and one 'marking_scheme' citation.",
            "items": {
              "type": "OBJECT",
              "properties": {
                "id": {
                  "type": "STRING",
                  "description": "Unique ID (e.g., 'cit-q1-student')."
                },
                "content": {
                  "type": "OBJECT",
                  "properties": {
                    "text": {
                      "type": "STRING",
                      "description": "The exact text quoted."
                    },
                    "source_type": {
                      "type": "STRING",
                      "enum": [
                        "student_answer",
                        "marking_scheme"
                      ],
                      "description": "Origin of the text."
                    }
                  },
                  "required": [
                    "text",
                    "source_type"
                  ]
                },
                "position": {
                  "type": "OBJECT",
                  "properties": {
                    "pageNumber": {
                      "type": "NUMBER",
                      "description": "The page number from the input headers (e.g., '==Screenshot for page X==')."
                    },
                    "boundingRect": {
                      "type": "OBJECT",
                      "properties": {
                        "x1": {
                          "type": "NUMBER"
                        },
                        "y1": {
                          "type": "NUMBER"
                        },
                        "x2": {
                          "type": "NUMBER"
                        },
                        "y2": {
                          "type": "NUMBER"
                        },
                        "width": {
                          "type": "NUMBER"
                        },
                        "height": {
                          "type": "NUMBER"
                        }
                      },
                      "description": "Null if unknown."
                    }
                  },
                  "required": [
                    "pageNumber"
                  ]
                }
              },
              "required": [
                "id",
                "content",
                "position"
              ]
            }
          }
        },
        "required": [
          "question_id",
          "marks_awarded",
          "reasoning",
          "missed_mark_reasoning",
          "required_for_improvement",
          "citations"
        ]
      }
    }
  },
  "required": [
    "total_marks",
    "total_available_marks",
    "paper_name",
    "question_breakdown"
  ]
}